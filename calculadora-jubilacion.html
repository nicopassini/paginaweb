<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Calculadora de Jubilaci√≥n | M√©todo FBC</title>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;500;600;700&family=Questrial&display=swap" rel="stylesheet">
<style>
@font-face {
  font-family: 'Century Gothic Fallback';
  src: local('Century Gothic'), local('CenturyGothic');
}

:root {
  --navy: #1a3753;
  --blue: #0b80e1;
  --black: #141414;
  --white: #ffffff;
  --teal: #11b3b7;
  --bg: #0d1b2e;
  --surface: #132640;
  --surface-2: #17304d;
  --surface-3: #1c3a5a;
  --border: #1f4672;
  --text: #e4eaf2;
  --text-muted: #8da4bf;
  --accent: var(--teal);
  --accent-glow: rgba(17, 179, 183, 0.15);
  --green: #11b3b7;
  --green-bg: rgba(17, 179, 183, 0.12);
  --orange: #f0a030;
  --orange-bg: rgba(240, 160, 48, 0.12);
  --red: #e85454;
  --red-bg: rgba(232, 84, 84, 0.12);
  --radius: 16px;
  --radius-sm: 10px;
  --font-main: 'Century Gothic Fallback', 'Questrial', 'Futura', 'Trebuchet MS', Arial, sans-serif;
}

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  font-family: var(--font-main);
  background: var(--bg);
  color: var(--text);
  min-height: 100vh;
  overflow-x: hidden;
}

.noise-overlay {
  position: fixed;
  top: 0; left: 0; width: 100%; height: 100%;
  opacity: 0.025;
  pointer-events: none;
  z-index: 0;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");
}

.glow-orb {
  position: fixed;
  width: 600px; height: 600px;
  border-radius: 50%;
  filter: blur(130px);
  opacity: 0.06;
  pointer-events: none;
  z-index: 0;
}
.glow-orb-1 { top: -200px; right: -100px; background: var(--blue); }
.glow-orb-2 { bottom: -200px; left: -100px; background: var(--teal); }

.container {
  position: relative;
  z-index: 1;
  max-width: 1100px;
  margin: 0 auto;
  padding: 40px 20px 60px;
}

/* HEADER */
.header {
  text-align: center;
  margin-bottom: 48px;
  animation: fadeInUp 0.7s ease;
}

.brand-logo {
  text-align: center;
  margin-bottom: 28px;
}

.brand-wordmark {
  font-family: 'Cormorant Garamond', Georgia, serif;
  font-size: 32px;
  font-weight: 300;
  letter-spacing: 6px;
  text-transform: uppercase;
  color: var(--white);
  display: inline-block;
}

.brand-wordmark-line {
  display: block;
  width: 100%;
  height: 1px;
  background: linear-gradient(90deg, transparent, var(--blue), var(--teal), transparent);
  margin-top: 6px;
}

.header .badge {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  background: var(--accent-glow);
  border: 1px solid rgba(17, 179, 183, 0.3);
  color: var(--accent);
  font-size: 11px;
  font-weight: 600;
  letter-spacing: 1.8px;
  text-transform: uppercase;
  padding: 6px 18px;
  border-radius: 100px;
  margin-bottom: 20px;
}

.header h1 {
  font-family: var(--font-main);
  font-size: clamp(28px, 5vw, 44px);
  font-weight: 700;
  line-height: 1.15;
  margin-bottom: 14px;
  background: linear-gradient(135deg, var(--white) 0%, var(--blue) 50%, var(--teal) 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

.header p {
  color: var(--text-muted);
  font-size: 16px;
  max-width: 600px;
  margin: 0 auto;
  line-height: 1.65;
}

/* MODE TABS */
.mode-tabs {
  display: flex;
  gap: 4px;
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 5px;
  margin-bottom: 32px;
  animation: fadeInUp 0.7s ease 0.1s both;
}

.mode-tab {
  flex: 1;
  padding: 14px 16px;
  border: none;
  border-radius: var(--radius-sm);
  background: transparent;
  color: var(--text-muted);
  font-family: var(--font-main);
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.25s;
  text-align: center;
}

.mode-tab:hover {
  color: var(--text);
}

.mode-tab.active {
  background: linear-gradient(135deg, rgba(11,128,225,0.15), rgba(17,179,183,0.15));
  color: var(--teal);
  box-shadow: 0 2px 8px rgba(0,0,0,0.2);
}

.mode-tab .tab-icon {
  display: block;
  font-size: 20px;
  margin-bottom: 4px;
}

/* MAIN GRID */
.main-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 28px;
  animation: fadeInUp 0.7s ease 0.15s both;
}

@media (max-width: 768px) {
  .main-grid { grid-template-columns: 1fr; }
}

/* CARDS */
.card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 32px;
  position: relative;
  overflow: hidden;
}

.card::before {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0;
  height: 2px;
  background: linear-gradient(90deg, transparent, var(--blue), var(--teal), transparent);
  opacity: 0.6;
}

.card-title {
  font-size: 12px;
  font-weight: 700;
  letter-spacing: 2.5px;
  text-transform: uppercase;
  color: var(--blue);
  margin-bottom: 28px;
  display: flex;
  align-items: center;
  gap: 10px;
}

.card-title .icon {
  width: 32px; height: 32px;
  background: rgba(11, 128, 225, 0.12);
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 16px;
}

/* FORM ELEMENTS */
.field {
  margin-bottom: 22px;
}

.field label {
  display: block;
  font-size: 13px;
  font-weight: 600;
  color: var(--text-muted);
  margin-bottom: 8px;
  letter-spacing: 0.3px;
}

.input-wrap {
  position: relative;
}

.input-wrap .prefix,
.input-wrap .suffix {
  position: absolute;
  top: 50%; transform: translateY(-50%);
  font-size: 14px;
  color: var(--text-muted);
  font-weight: 500;
  pointer-events: none;
}

.input-wrap .prefix { left: 16px; }
.input-wrap .suffix { right: 16px; }

input[type="number"],
input[type="text"] {
  width: 100%;
  background: var(--surface-2);
  border: 1.5px solid var(--border);
  border-radius: var(--radius-sm);
  padding: 14px 16px;
  font-family: var(--font-main);
  font-size: 16px;
  font-weight: 600;
  color: var(--text);
  transition: all 0.25s;
  -moz-appearance: textfield;
}

input::-webkit-outer-spin-button,
input::-webkit-inner-spin-button {
  -webkit-appearance: none;
  margin: 0;
}

input:focus {
  outline: none;
  border-color: var(--blue);
  box-shadow: 0 0 0 3px rgba(11, 128, 225, 0.2);
}

.input-with-prefix { padding-left: 36px !important; }
.input-with-suffix { padding-right: 60px !important; }

/* ARS EQUIV */
.ars-equiv {
  font-size: 12px;
  color: var(--text-muted);
  margin-top: 5px;
  opacity: 0.7;
}

.ars-config {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 24px;
  padding: 12px 16px;
  background: var(--surface-2);
  border-radius: var(--radius-sm);
  border: 1px solid var(--border);
}

.ars-config label {
  font-size: 12px;
  color: var(--text-muted);
  font-weight: 600;
  white-space: nowrap;
}

.ars-config input {
  width: 120px;
  padding: 8px 12px;
  font-size: 14px;
}

/* PROFILE SELECTOR */
.profile-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 10px;
  margin-bottom: 10px;
}

.profile-btn {
  background: var(--surface-2);
  border: 1.5px solid var(--border);
  border-radius: var(--radius-sm);
  padding: 14px 12px;
  cursor: pointer;
  transition: all 0.25s;
  text-align: center;
}

.profile-btn:hover {
  border-color: var(--text-muted);
  transform: translateY(-1px);
}

.profile-btn.active {
  border-color: var(--blue);
  background: rgba(11, 128, 225, 0.1);
  box-shadow: 0 0 0 3px rgba(11, 128, 225, 0.15);
}

.profile-btn .pname {
  font-size: 13px;
  font-weight: 700;
  color: var(--text);
  margin-bottom: 3px;
}

.profile-btn .prate {
  font-size: 20px;
  font-weight: 700;
  color: var(--blue);
}

.profile-btn.active .prate { color: var(--teal); }

.profile-btn .pdesc {
  font-size: 11px;
  color: var(--text-muted);
  margin-top: 2px;
}

.custom-rate-field {
  margin-top: 10px;
  display: none;
}

.custom-rate-field.visible {
  display: block;
}

/* TWO COL FIELDS */
.fields-row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 14px;
}

/* SUB-MODE SELECTOR (for goal mode) */
.submode-row {
  display: flex;
  gap: 8px;
  margin-bottom: 22px;
}

.submode-btn {
  flex: 1;
  padding: 12px 10px;
  border: 1.5px solid var(--border);
  border-radius: var(--radius-sm);
  background: var(--surface-2);
  color: var(--text-muted);
  font-family: var(--font-main);
  font-size: 13px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.25s;
  text-align: center;
}

.submode-btn:hover { border-color: var(--text-muted); }

.submode-btn.active {
  border-color: var(--teal);
  background: var(--accent-glow);
  color: var(--teal);
}

/* BUTTON */
.calc-btn {
  width: 100%;
  padding: 18px;
  background: linear-gradient(135deg, var(--blue), var(--teal));
  border: none;
  border-radius: var(--radius-sm);
  font-family: var(--font-main);
  font-size: 16px;
  font-weight: 700;
  color: var(--white);
  cursor: pointer;
  transition: all 0.3s;
  letter-spacing: 0.5px;
  margin-top: 8px;
  position: relative;
  overflow: hidden;
}

.calc-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(11, 128, 225, 0.3);
}

.calc-btn:active { transform: translateY(0); }

/* RESULTS PANEL */
.results-panel {
  display: none;
}

.results-panel.visible {
  display: block;
  animation: fadeInUp 0.5s ease;
}

.result-hero {
  text-align: center;
  padding: 32px 24px;
  background: var(--surface-2);
  border-radius: var(--radius);
  margin-bottom: 24px;
  border: 1px solid var(--border);
  position: relative;
  overflow: hidden;
}

.result-hero::after {
  content: '';
  position: absolute;
  inset: 0;
  border-radius: var(--radius);
  pointer-events: none;
}

.result-hero.status-green::after { background: var(--green-bg); }
.result-hero.status-orange::after { background: var(--orange-bg); }
.result-hero.status-red::after { background: var(--red-bg); }

.result-hero .status-badge {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 6px 16px;
  border-radius: 100px;
  font-size: 11px;
  font-weight: 700;
  letter-spacing: 1.2px;
  text-transform: uppercase;
  margin-bottom: 16px;
  position: relative;
  z-index: 1;
}

.status-green .status-badge { background: var(--green-bg); color: var(--green); border: 1px solid rgba(17,179,183,0.35); }
.status-orange .status-badge { background: var(--orange-bg); color: var(--orange); border: 1px solid rgba(240,160,48,0.35); }
.status-red .status-badge { background: var(--red-bg); color: var(--red); border: 1px solid rgba(232,84,84,0.35); }

.result-hero .big-number {
  font-size: clamp(30px, 6vw, 46px);
  font-weight: 700;
  position: relative;
  z-index: 1;
}

.status-green .big-number { color: var(--green); }
.status-orange .big-number { color: var(--orange); }
.status-red .big-number { color: var(--red); }

.result-hero .big-label {
  font-size: 14px;
  color: var(--text-muted);
  margin-top: 6px;
  position: relative;
  z-index: 1;
}

.result-hero .ars-line {
  font-size: 16px;
  color: var(--text-muted);
  margin-top: 4px;
  position: relative;
  z-index: 1;
  opacity: 0.7;
}

/* METRICS GRID */
.metrics-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 12px;
  margin-bottom: 24px;
}

.metric-card {
  background: var(--surface-2);
  border: 1px solid var(--border);
  border-radius: var(--radius-sm);
  padding: 18px 16px;
}

.metric-card .mc-label {
  font-size: 11px;
  font-weight: 600;
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 0.8px;
  margin-bottom: 6px;
}

.metric-card .mc-value {
  font-size: 20px;
  font-weight: 700;
  color: var(--text);
}

.metric-card .mc-sub {
  font-size: 12px;
  color: var(--text-muted);
  margin-top: 3px;
}

/* BREAKDOWN BAR */
.breakdown {
  margin-bottom: 24px;
}

.breakdown-title {
  font-size: 12px;
  font-weight: 600;
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 0.8px;
  margin-bottom: 12px;
}

.breakdown-bar {
  height: 14px;
  border-radius: 100px;
  overflow: hidden;
  display: flex;
  background: var(--surface-3);
}

.breakdown-bar .seg {
  height: 100%;
  transition: width 0.6s ease;
}

.seg-contrib { background: var(--navy); }
.seg-interest { background: linear-gradient(90deg, var(--blue), var(--teal)); }

.breakdown-legend {
  display: flex;
  gap: 20px;
  margin-top: 10px;
}

.breakdown-legend .leg-item {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 12px;
  color: var(--text-muted);
}

.leg-item .dot {
  width: 10px; height: 10px;
  border-radius: 50%;
}

/* RECOMMENDATIONS */
.reco-box {
  background: var(--surface-2);
  border-radius: var(--radius-sm);
  padding: 24px;
  border-left: 3px solid;
  margin-bottom: 16px;
}

.reco-box.reco-green { border-color: var(--green); }
.reco-box.reco-orange { border-color: var(--orange); }
.reco-box.reco-red { border-color: var(--red); }

.reco-box h4 {
  font-size: 15px;
  font-weight: 700;
  margin-bottom: 10px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.reco-green h4 { color: var(--green); }
.reco-orange h4 { color: var(--orange); }
.reco-red h4 { color: var(--red); }

.reco-box p {
  font-size: 14px;
  color: var(--text-muted);
  line-height: 1.65;
}

.reco-box ul {
  margin-top: 10px;
  padding-left: 0;
  list-style: none;
}

.reco-box li {
  font-size: 13px;
  color: var(--text-muted);
  line-height: 1.6;
  padding: 4px 0;
  padding-left: 20px;
  position: relative;
}

.reco-box li::before {
  content: '‚Üí';
  position: absolute;
  left: 0;
  color: var(--teal);
  font-weight: 700;
}

/* CHART */
.chart-container {
  background: var(--surface-2);
  border: 1px solid var(--border);
  border-radius: var(--radius-sm);
  padding: 24px;
  margin-bottom: 24px;
}

.chart-title {
  font-size: 12px;
  font-weight: 600;
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 0.8px;
  margin-bottom: 16px;
}

canvas#growthChart {
  width: 100% !important;
  height: 220px !important;
}

/* CTA */
.cta-section {
  text-align: center;
  margin-top: 40px;
  padding: 44px 28px;
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  position: relative;
  overflow: hidden;
  animation: fadeInUp 0.7s ease 0.3s both;
}

.cta-section::before {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0;
  height: 2px;
  background: linear-gradient(90deg, var(--blue), var(--teal), var(--blue));
}

.cta-section h3 {
  font-size: 22px;
  font-weight: 700;
  margin-bottom: 14px;
  color: var(--white);
}

.cta-section p {
  color: var(--text-muted);
  font-size: 15px;
  margin-bottom: 28px;
  max-width: 520px;
  margin-left: auto;
  margin-right: auto;
  line-height: 1.7;
}

.cta-btn {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 16px 40px;
  background: linear-gradient(135deg, var(--blue), var(--teal));
  border: none;
  border-radius: var(--radius-sm);
  font-family: var(--font-main);
  font-size: 15px;
  font-weight: 700;
  color: var(--white);
  cursor: pointer;
  transition: all 0.3s;
  text-decoration: none;
}

.cta-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(11, 128, 225, 0.3);
}

/* DISCLAIMER */
.disclaimer {
  text-align: center;
  margin-top: 32px;
  padding: 20px;
  font-size: 12px;
  color: var(--text-muted);
  opacity: 0.7;
  line-height: 1.7;
  max-width: 600px;
  margin-left: auto;
  margin-right: auto;
}

.disclaimer a {
  color: var(--teal);
  text-decoration: none;
  transition: color 0.2s;
}

.disclaimer a:hover {
  color: var(--blue);
  text-decoration: underline;
}

/* HIDDEN */
.hidden { display: none !important; }

/* ANIMATIONS */
@keyframes fadeInUp {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}

/* SCROLLBAR */
::-webkit-scrollbar { width: 6px; }
::-webkit-scrollbar-track { background: var(--bg); }
::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }
</style>
</head>
<body>

<div class="noise-overlay"></div>
<div class="glow-orb glow-orb-1"></div>
<div class="glow-orb glow-orb-2"></div>

<div class="container">
  <!-- HEADER -->
  <div class="header">
    <div class="brand-logo">
      <span class="brand-wordmark">NICO PASSINI<span class="brand-wordmark-line"></span></span>
    </div>

    <div class="badge">‚ö° Herramienta gratuita</div>
    <h1>Simulador de Jubilaci√≥n</h1>
    <p>Descubr√≠ si tu plan financiero actual te va a permitir vivir tranquilo cuando te jubiles, o calcul√° exactamente cu√°nto necesit√°s para alcanzar tu objetivo.</p>
  </div>

  <!-- MODE TABS -->
  <div class="mode-tabs">
    <button class="mode-tab active" onclick="switchMode('age')">
      <span class="tab-icon">üïê</span>
      Por edad de jubilaci√≥n
    </button>
    <button class="mode-tab" onclick="switchMode('goal')">
      <span class="tab-icon">üéØ</span>
      Por objetivo financiero
    </button>
  </div>

  <!-- MAIN GRID -->
  <div class="main-grid">
    <!-- LEFT: INPUTS -->
    <div>
      <!-- ========== MODE: AGE ========== -->
      <div id="modeAge">
        <div class="card" style="margin-bottom: 28px;">
          <div class="card-title"><div class="icon">üë§</div> Tu situaci√≥n actual</div>

          <div class="fields-row">
            <div class="field">
              <label>Edad actual</label>
              <div class="input-wrap">
                <input type="number" id="a_currentAge" value="30" min="18" max="80">
                <span class="suffix">a√±os</span>
              </div>
            </div>
            <div class="field">
              <label>Edad de jubilaci√≥n</label>
              <div class="input-wrap">
                <input type="number" id="a_retireAge" value="60" min="30" max="85">
                <span class="suffix">a√±os</span>
              </div>
            </div>
          </div>

          <div class="field">
            <label>Expectativa de vida</label>
            <div class="input-wrap">
              <input type="number" id="a_lifeExpect" value="85" min="60" max="110">
              <span class="suffix">a√±os</span>
            </div>
          </div>

          <div class="field">
            <label>Ahorro inicial (capital actual)</label>
            <div class="input-wrap">
              <span class="prefix">$</span>
              <input type="number" id="a_initialSaving" value="5000" min="0" class="input-with-prefix input-with-suffix" oninput="showARS(this, 'a_initialARS')">
              <span class="suffix">USD</span>
            </div>
            <div class="ars-equiv" id="a_initialARS"></div>
          </div>

          <div class="field">
            <label>Aporte mensual</label>
            <div class="input-wrap">
              <span class="prefix">$</span>
              <input type="number" id="a_monthlyContrib" value="300" min="0" class="input-with-prefix input-with-suffix" oninput="showARS(this, 'a_monthlyARS')">
              <span class="suffix">USD</span>
            </div>
            <div class="ars-equiv" id="a_monthlyARS"></div>
          </div>

          <div class="field">
            <label>Gasto mensual planeado en retiro</label>
            <div class="input-wrap">
              <span class="prefix">$</span>
              <input type="number" id="a_monthlySpend" value="2000" min="0" class="input-with-prefix input-with-suffix" oninput="showARS(this, 'a_spendARS')">
              <span class="suffix">USD</span>
            </div>
            <div class="ars-equiv" id="a_spendARS"></div>
          </div>
        </div>
      </div>

      <!-- ========== MODE: GOAL ========== -->
      <div id="modeGoal" class="hidden">
        <div class="card" style="margin-bottom: 28px;">
          <div class="card-title"><div class="icon">üéØ</div> Tu objetivo financiero</div>

          <div class="submode-row">
            <button class="submode-btn active" onclick="switchSubmode('howMuch')">üí∞ ¬øCu√°nto aportar?</button>
            <button class="submode-btn" onclick="switchSubmode('howLong')">‚è± ¬øCu√°nto tiempo?</button>
          </div>

          <div class="field">
            <label>Objetivo de capital</label>
            <div class="input-wrap">
              <span class="prefix">$</span>
              <input type="number" id="g_goalAmount" value="500000" min="1000" class="input-with-prefix input-with-suffix" oninput="showARS(this, 'g_goalARS')">
              <span class="suffix">USD</span>
            </div>
            <div class="ars-equiv" id="g_goalARS"></div>
          </div>

          <div class="field">
            <label>Ahorro inicial (capital actual)</label>
            <div class="input-wrap">
              <span class="prefix">$</span>
              <input type="number" id="g_initialSaving" value="5000" min="0" class="input-with-prefix input-with-suffix" oninput="showARS(this, 'g_initialARS')">
              <span class="suffix">USD</span>
            </div>
            <div class="ars-equiv" id="g_initialARS"></div>
          </div>

          <!-- howMuch submode: user sets years, we calc monthly -->
          <div id="submodeHowMuch">
            <div class="field">
              <label>Plazo para alcanzar el objetivo</label>
              <div class="input-wrap">
                <input type="number" id="g_years" value="20" min="1" max="50">
                <span class="suffix">a√±os</span>
              </div>
            </div>
          </div>

          <!-- howLong submode: user sets monthly, we calc years -->
          <div id="submodeHowLong" class="hidden">
            <div class="field">
              <label>Aporte mensual</label>
              <div class="input-wrap">
                <span class="prefix">$</span>
                <input type="number" id="g_monthly" value="500" min="1" class="input-with-prefix input-with-suffix" oninput="showARS(this, 'g_monthlyARS')">
                <span class="suffix">USD</span>
              </div>
              <div class="ars-equiv" id="g_monthlyARS"></div>
            </div>
          </div>

          <div class="field">
            <label>Edad actual (opcional, para referencia)</label>
            <div class="input-wrap">
              <input type="number" id="g_currentAge" value="30" min="18" max="80">
              <span class="suffix">a√±os</span>
            </div>
          </div>
        </div>
      </div>

      <!-- SHARED: Investment Profile + ARS Rate -->
      <div class="card">
        <div class="card-title"><div class="icon">üìä</div> Perfil de inversi√≥n</div>
        <div class="profile-grid">
          <div class="profile-btn" data-rate="5" onclick="selectProfile(this)">
            <div class="pname">Conservador</div>
            <div class="prate">5%</div>
            <div class="pdesc">Bonos, renta fija</div>
          </div>
          <div class="profile-btn active" data-rate="7" onclick="selectProfile(this)">
            <div class="pname">Moderado</div>
            <div class="prate">7%</div>
            <div class="pdesc">Mix equilibrado</div>
          </div>
          <div class="profile-btn" data-rate="9" onclick="selectProfile(this)">
            <div class="pname">Agresivo</div>
            <div class="prate">9%</div>
            <div class="pdesc">Acciones, cripto</div>
          </div>
          <div class="profile-btn" data-rate="custom" onclick="selectProfile(this)">
            <div class="pname">Personalizado</div>
            <div class="prate">?%</div>
            <div class="pdesc">Defin√≠ tu tasa</div>
          </div>
        </div>
        <div class="custom-rate-field" id="customRateField">
          <div class="field" style="margin-bottom:0;">
            <label>Rendimiento anual esperado</label>
            <div class="input-wrap">
              <input type="number" id="customRate" value="8" min="1" max="30" step="0.5">
              <span class="suffix">%</span>
            </div>
          </div>
        </div>

        <div class="ars-config" style="margin-top: 20px;">
          <label>üá¶üá∑ USD/ARS:</label>
          <div class="input-wrap">
            <span class="prefix">$</span>
            <input type="number" id="arsRate" value="1200" min="1" style="width:120px; padding-left:28px;" oninput="updateAllARS()">
          </div>
          <span id="arsSource" style="font-size:11px; color: var(--text-muted); opacity:0.6;"></span>
        </div>

        <button class="calc-btn" onclick="calculate()">
          Calcular ‚Üí
        </button>
      </div>
    </div>

    <!-- RIGHT: RESULTS -->
    <div>
      <div class="card" id="resultsCard" style="min-height: 400px; display:flex; align-items:center; justify-content:center;">
        <div id="placeholder" style="text-align:center; color: var(--text-muted);">
          <div style="font-size:48px; margin-bottom:16px; opacity:0.3;">üìà</div>
          <p style="font-size:15px;">Complet√° tus datos y presion√°<br><strong style="color:var(--blue);">Calcular</strong> para ver tu diagn√≥stico</p>
        </div>
        <div class="results-panel" id="results">
          <div class="card-title"><div class="icon">üéØ</div> <span id="resultTitle">Tu diagn√≥stico</span></div>

          <!-- HERO -->
          <div class="result-hero" id="resultHero">
            <div class="status-badge" id="statusBadge"></div>
            <div class="big-number" id="totalFund"></div>
            <div class="ars-line" id="totalFundARS"></div>
            <div class="big-label" id="bigLabel"></div>
          </div>

          <!-- METRICS -->
          <div class="metrics-grid" id="metricsGrid">
            <div class="metric-card">
              <div class="mc-label" id="met1Label">A√±os ahorrando</div>
              <div class="mc-value" id="met1Value"></div>
              <div class="mc-sub" id="met1Sub"></div>
            </div>
            <div class="metric-card">
              <div class="mc-label" id="met2Label">Total aportado</div>
              <div class="mc-value" id="met2Value"></div>
              <div class="mc-sub" id="met2Sub"></div>
            </div>
            <div class="metric-card">
              <div class="mc-label" id="met3Label">Ganancia por inter√©s</div>
              <div class="mc-value" id="met3Value"></div>
              <div class="mc-sub" id="met3Sub"></div>
            </div>
            <div class="metric-card">
              <div class="mc-label" id="met4Label">Duraci√≥n de fondos</div>
              <div class="mc-value" id="met4Value"></div>
              <div class="mc-sub" id="met4Sub"></div>
            </div>
          </div>

          <!-- BREAKDOWN -->
          <div class="breakdown" id="breakdownSection">
            <div class="breakdown-title">Composici√≥n de tu capital</div>
            <div class="breakdown-bar">
              <div class="seg seg-contrib" id="segContrib"></div>
              <div class="seg seg-interest" id="segInterest"></div>
            </div>
            <div class="breakdown-legend">
              <div class="leg-item"><div class="dot" style="background:var(--navy)"></div> Tu aporte</div>
              <div class="leg-item"><div class="dot" style="background:linear-gradient(90deg, var(--blue), var(--teal))"></div> Inter√©s compuesto</div>
            </div>
          </div>

          <!-- CHART -->
          <div class="chart-container">
            <div class="chart-title">Proyecci√≥n de crecimiento</div>
            <canvas id="growthChart"></canvas>
          </div>

          <!-- TABLE -->
          <div class="table-section" id="tableSection" style="background:var(--surface-2);border:1px solid var(--border);border-radius:var(--radius-sm);padding:24px;margin-bottom:24px;overflow-x:auto;">
            <div style="display:flex;align-items:center;justify-content:space-between;cursor:pointer;" onclick="toggleTable()">
              <div style="font-size:12px;font-weight:600;color:var(--text-muted);text-transform:uppercase;letter-spacing:.8px;display:flex;align-items:center;gap:10px;">üìã Tabla a√±o por a√±o</div>
              <span id="tableArrow" style="font-size:16px;color:var(--text-muted);transition:transform .3s;">‚ñº</span>
            </div>
            <div id="tableBody" style="display:none;margin-top:16px;">
              <table style="width:100%;border-collapse:collapse;font-size:13px;">
                <thead><tr>
                  <th style="text-align:left;padding:10px 12px;border-bottom:2px solid var(--border);font-size:11px;font-weight:700;color:var(--text-muted);text-transform:uppercase;">A√±o</th>
                  <th style="text-align:left;padding:10px 12px;border-bottom:2px solid var(--border);font-size:11px;font-weight:700;color:var(--text-muted);text-transform:uppercase;">Edad</th>
                  <th style="text-align:left;padding:10px 12px;border-bottom:2px solid var(--border);font-size:11px;font-weight:700;color:var(--text-muted);text-transform:uppercase;">Aportado</th>
                  <th style="text-align:left;padding:10px 12px;border-bottom:2px solid var(--border);font-size:11px;font-weight:700;color:var(--text-muted);text-transform:uppercase;">Inter√©s</th>
                  <th style="text-align:left;padding:10px 12px;border-bottom:2px solid var(--border);font-size:11px;font-weight:700;color:var(--text-muted);text-transform:uppercase;">Total</th>
                </tr></thead>
                <tbody id="tableRows"></tbody>
              </table>
              <button onclick="downloadCSV()" style="margin-top:16px;padding:10px 20px;background:var(--surface-3);border:1px solid var(--border);border-radius:var(--radius-sm);color:var(--text-muted);font-family:var(--font-main);font-size:13px;font-weight:600;cursor:pointer;display:inline-flex;align-items:center;gap:6px;">üì• Descargar CSV</button>
            </div>
          </div>

          <!-- RECOMMENDATIONS -->
          <div id="recoContainer"></div>

          <!-- SHARE -->
          <div style="text-align:center;margin-top:24px;">
            <h3 style="font-size:16px;font-weight:700;color:var(--white);margin-bottom:8px;">üì≤ Compart√≠ tu resultado</h3>
            <div style="display:flex;gap:10px;justify-content:center;flex-wrap:wrap;">
              <button onclick="shareWhatsApp()" style="display:inline-flex;align-items:center;gap:8px;padding:10px 20px;border-radius:10px;font-family:var(--font-main);font-size:13px;font-weight:600;cursor:pointer;border:none;color:white;background:#25D366;">üí¨ WhatsApp</button>
              <button onclick="shareTwitter()" style="display:inline-flex;align-items:center;gap:8px;padding:10px 20px;border-radius:10px;font-family:var(--font-main);font-size:13px;font-weight:600;cursor:pointer;border:none;color:white;background:#1DA1F2;">üê¶ Twitter/X</button>
              <button onclick="shareFacebook()" style="display:inline-flex;align-items:center;gap:8px;padding:10px 20px;border-radius:10px;font-family:var(--font-main);font-size:13px;font-weight:600;cursor:pointer;border:none;color:white;background:#1877F2;">üìò Facebook</button>
              <button onclick="copyLink()" style="display:inline-flex;align-items:center;gap:8px;padding:10px 20px;border-radius:10px;font-family:var(--font-main);font-size:13px;font-weight:600;cursor:pointer;border:none;color:var(--text-muted);background:var(--surface-3);border:1px solid var(--border);">üîó Copiar link</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- CTA -->
  <div class="cta-section">
    <h3>¬øQuer√©s aprender a armar tu propio plan financiero?</h3>
    <p>Esta calculadora es solo el primer paso. En mi academia <strong>Finanzas Bajo Control</strong> te ense√±o a ordenarte financieramente y aprender a invertir desde cero, sin necesidad de tener ning√∫n conocimiento previo.</p>
    <a href="https://metodofbc.com/" target="_blank" class="cta-btn">Quiero saber m√°s ‚Üí</a>
  </div>

  <!-- DISCLAIMER -->
  <div class="disclaimer">
    Herramienta creada con fines educativos por <a href="https://instagram.com/nicopassini_" target="_blank">@nicopassini_</a><br>
    Los rendimientos utilizados son estimados y no garantizan resultados futuros. Esta herramienta no constituye asesoramiento financiero, de inversi√≥n ni recomendaci√≥n de compra o venta de activos.
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<script>
let selectedRate = 7;
let chartInstance = null;
let currentMode = 'age';
let currentSubmode = 'howMuch';

// ====== MODE SWITCHING ======
function switchMode(mode) {
  currentMode = mode;
  document.querySelectorAll('.mode-tab').forEach(t => t.classList.remove('active'));
  event.currentTarget.classList.add('active');
  document.getElementById('modeAge').classList.toggle('hidden', mode !== 'age');
  document.getElementById('modeGoal').classList.toggle('hidden', mode !== 'goal');
  resetResults();
}

function switchSubmode(sub) {
  currentSubmode = sub;
  document.querySelectorAll('.submode-btn').forEach(b => b.classList.remove('active'));
  event.currentTarget.classList.add('active');
  document.getElementById('submodeHowMuch').classList.toggle('hidden', sub !== 'howMuch');
  document.getElementById('submodeHowLong').classList.toggle('hidden', sub !== 'howLong');
}

function resetResults() {
  document.getElementById('results').classList.remove('visible');
  document.getElementById('placeholder').style.display = '';
  document.getElementById('resultsCard').style.alignItems = 'center';
}

// ====== PROFILE ======
function selectProfile(el) {
  document.querySelectorAll('.profile-btn').forEach(b => b.classList.remove('active'));
  el.classList.add('active');
  const rate = el.dataset.rate;
  if (rate === 'custom') {
    document.getElementById('customRateField').classList.add('visible');
    selectedRate = parseFloat(document.getElementById('customRate').value) || 8;
  } else {
    document.getElementById('customRateField').classList.remove('visible');
    selectedRate = parseFloat(rate);
  }
}

document.getElementById('customRate').addEventListener('input', function() {
  selectedRate = parseFloat(this.value) || 0;
});

// ====== ARS DISPLAY ======
async function fetchARSRate() {
  const sourceEl = document.getElementById('arsSource');
  const rateInput = document.getElementById('arsRate');

  // Try multiple APIs in order
  const apis = [
    {
      url: 'https://dolarapi.com/v1/dolares/oficial',
      parse: (d) => d.venta,
      name: 'DolarAPI'
    },
    {
      url: 'https://api.bluelytics.com.ar/v2/latest',
      parse: (d) => d.oficial?.value_sell || d.oficial?.value_avg,
      name: 'Bluelytics'
    }
  ];

  for (const api of apis) {
    try {
      const controller = new AbortController();
      const timeout = setTimeout(() => controller.abort(), 4000);
      const res = await fetch(api.url, { signal: controller.signal });
      clearTimeout(timeout);
      if (!res.ok) continue;
      const data = await res.json();
      const rate = api.parse(data);
      if (rate && rate > 0) {
        rateInput.value = Math.round(rate);
        sourceEl.textContent = '(auto ¬∑ ' + api.name + ')';
        updateAllARS();
        return;
      }
    } catch (e) {
      continue;
    }
  }
  // Fallback: keep default value
  sourceEl.textContent = '(manual)';
  updateAllARS();
}

function getARS() {
  return parseFloat(document.getElementById('arsRate').value) || 1200;
}

function formatUSD(n) {
  return 'US$ ' + Math.round(n).toLocaleString('en-US');
}

function formatARS(n) {
  return 'ARS $ ' + Math.round(n).toLocaleString('es-AR');
}

function showARS(input, targetId) {
  const val = parseFloat(input.value) || 0;
  const el = document.getElementById(targetId);
  if (el) el.textContent = '‚âà ' + formatARS(val * getARS());
}

function updateAllARS() {
  // Update all visible ARS equivalences
  const pairs = [
    ['a_initialSaving', 'a_initialARS'],
    ['a_monthlyContrib', 'a_monthlyARS'],
    ['a_monthlySpend', 'a_spendARS'],
    ['g_goalAmount', 'g_goalARS'],
    ['g_initialSaving', 'g_initialARS'],
    ['g_monthly', 'g_monthlyARS']
  ];
  pairs.forEach(([inputId, arsId]) => {
    const input = document.getElementById(inputId);
    if (input) showARS(input, arsId);
  });
}

// ====== FUTURE VALUE ======
function futureValue(initial, monthly, rateAnnual, months) {
  const r = rateAnnual / 100 / 12;
  if (r === 0) return initial + monthly * months;
  let bal = initial;
  for (let m = 0; m < months; m++) {
    bal = bal * (1 + r) + monthly;
  }
  return bal;
}

// Solve for monthly contribution needed
function solveMonthly(initial, goal, rateAnnual, months) {
  const r = rateAnnual / 100 / 12;
  if (r === 0) return (goal - initial) / months;
  // FV = initial*(1+r)^n + PMT*((1+r)^n - 1)/r
  const fvInitial = initial * Math.pow(1 + r, months);
  const factor = (Math.pow(1 + r, months) - 1) / r;
  return Math.max(0, (goal - fvInitial) / factor);
}

// Solve for months needed
function solveMonths(initial, monthly, rateAnnual, goal) {
  const r = rateAnnual / 100 / 12;
  let bal = initial;
  for (let m = 1; m <= 600; m++) { // max 50 years
    bal = bal * (1 + r) + monthly;
    if (bal >= goal) return m;
  }
  return Infinity;
}

// ====== CALCULATE ======
function calculate() {
  if (currentMode === 'age') calculateAge();
  else calculateGoal();
}

function calculateAge() {
  const currentAge = parseInt(document.getElementById('a_currentAge').value);
  const retireAge = parseInt(document.getElementById('a_retireAge').value);
  const lifeExpect = parseInt(document.getElementById('a_lifeExpect').value);
  const initial = parseFloat(document.getElementById('a_initialSaving').value) || 0;
  const monthly = parseFloat(document.getElementById('a_monthlyContrib').value) || 0;
  const spend = parseFloat(document.getElementById('a_monthlySpend').value) || 0;
  const rate = selectedRate / 100;
  const monthlyRate = rate / 12;

  if (retireAge <= currentAge) { alert('La edad de jubilaci√≥n debe ser mayor a tu edad actual.'); return; }
  if (lifeExpect <= retireAge) { alert('La expectativa de vida debe ser mayor a la edad de jubilaci√≥n.'); return; }

  const yearsToRetire = retireAge - currentAge;
  const monthsToRetire = yearsToRetire * 12;

  let balance = initial;
  let totalContrib = initial;
  const chartData = [{ age: currentAge, balance: balance }];

  for (let m = 1; m <= monthsToRetire; m++) {
    balance = balance * (1 + monthlyRate) + monthly;
    totalContrib += monthly;
    if (m % 12 === 0) chartData.push({ age: currentAge + m / 12, balance: balance });
  }

  const totalAtRetire = balance;
  const totalInterest = totalAtRetire - totalContrib;

  const retirementYears = lifeExpect - retireAge;
  let fundDurationMonths = 0;
  const postRetireMonthlyRate = 0.03 / 12;

  if (spend <= 0) {
    fundDurationMonths = Infinity;
  } else {
    let wb = totalAtRetire;
    for (let m = 1; m <= (retirementYears + 20) * 12; m++) {
      wb = wb * (1 + postRetireMonthlyRate) - spend;
      if (wb <= 0) { fundDurationMonths = m; break; }
      if (m === (retirementYears + 20) * 12) fundDurationMonths = Infinity;
    }
    // Chart post-retire
    let postBal = totalAtRetire;
    for (let y = 1; y <= retirementYears && postBal > 0; y++) {
      for (let m = 0; m < 12; m++) {
        postBal = postBal * (1 + postRetireMonthlyRate) - spend;
        if (postBal <= 0) { postBal = 0; break; }
      }
      chartData.push({ age: retireAge + y, balance: Math.max(0, postBal) });
    }
  }

  const fundDurationYears = fundDurationMonths === Infinity ? Infinity : fundDurationMonths / 12;
  const needYears = lifeExpect - retireAge;

  let status, statusText;
  if (fundDurationYears === Infinity || fundDurationYears >= needYears * 1.2) {
    status = 'green'; statusText = '‚úì Plan s√≥lido';
  } else if (fundDurationYears >= needYears * 0.8) {
    status = 'orange'; statusText = '‚ö† Necesita ajustes';
  } else {
    status = 'red'; statusText = '‚úï Plan insuficiente';
  }

  // Show results
  showResults();
  document.getElementById('resultTitle').textContent = 'Tu diagn√≥stico de jubilaci√≥n';

  const hero = document.getElementById('resultHero');
  hero.className = 'result-hero status-' + status;
  document.getElementById('statusBadge').textContent = statusText;
  document.getElementById('totalFund').textContent = formatUSD(totalAtRetire);
  document.getElementById('totalFundARS').textContent = '‚âà ' + formatARS(totalAtRetire * getARS());
  document.getElementById('bigLabel').textContent = 'Capital acumulado al jubilarte';

  document.getElementById('met1Label').textContent = 'A√±os ahorrando';
  document.getElementById('met1Value').textContent = yearsToRetire + ' a√±os';
  document.getElementById('met1Sub').textContent = '';

  document.getElementById('met2Label').textContent = 'Total aportado';
  document.getElementById('met2Value').textContent = formatUSD(totalContrib);
  document.getElementById('met2Sub').textContent = '';

  document.getElementById('met3Label').textContent = 'Ganancia por inter√©s';
  document.getElementById('met3Value').textContent = formatUSD(totalInterest);
  document.getElementById('met3Sub').textContent = ((totalInterest / totalAtRetire) * 100).toFixed(0) + '% del total';

  document.getElementById('met4Label').textContent = 'Duraci√≥n de fondos';
  if (fundDurationYears === Infinity) {
    document.getElementById('met4Value').textContent = '‚àû';
    document.getElementById('met4Sub').textContent = 'Tus fondos no se agotan';
  } else {
    document.getElementById('met4Value').textContent = fundDurationYears.toFixed(1) + ' a√±os';
    const shortfall = needYears - fundDurationYears;
    document.getElementById('met4Sub').textContent = shortfall > 0
      ? 'Te faltan ' + shortfall.toFixed(1) + ' a√±os'
      : 'Cubr√≠s tu expectativa de vida';
  }

  document.getElementById('breakdownSection').classList.remove('hidden');
  const contribPct = (totalContrib / totalAtRetire) * 100;
  document.getElementById('segContrib').style.width = contribPct + '%';
  document.getElementById('segInterest').style.width = (100 - contribPct) + '%';

  renderChart(chartData.map(d => d.age), chartData.map(d => d.balance), retireAge);
  renderTableAge(initial, monthly, selectedRate, yearsToRetire, currentAge);
  generateRecosAge(status, {
    totalAtRetire, totalContrib, totalInterest, fundDurationYears, needYears,
    monthly, spend, yearsToRetire, selectedRate, currentAge, retireAge
  });
}

function calculateGoal() {
  const goal = parseFloat(document.getElementById('g_goalAmount').value) || 0;
  const initial = parseFloat(document.getElementById('g_initialSaving').value) || 0;
  const age = parseInt(document.getElementById('g_currentAge').value) || 30;

  if (goal <= 0) { alert('Ingres√° un objetivo mayor a 0.'); return; }
  if (goal <= initial) { alert('Ya ten√©s el capital suficiente. ¬°Objetivo cumplido!'); return; }

  showResults();

  if (currentSubmode === 'howMuch') {
    // User sets years ‚Üí we calc monthly
    const years = parseInt(document.getElementById('g_years').value) || 1;
    const months = years * 12;
    const neededMonthly = solveMonthly(initial, goal, selectedRate, months);
    const totalContrib = initial + neededMonthly * months;
    const totalInterest = goal - totalContrib;

    document.getElementById('resultTitle').textContent = 'Tu plan para alcanzar ' + formatUSD(goal);

    const hero = document.getElementById('resultHero');
    hero.className = 'result-hero status-green';
    document.getElementById('statusBadge').textContent = 'üí∞ Aporte mensual necesario';
    document.getElementById('totalFund').textContent = formatUSD(neededMonthly) + '/mes';
    document.getElementById('totalFundARS').textContent = '‚âà ' + formatARS(neededMonthly * getARS()) + '/mes';
    document.getElementById('bigLabel').textContent = 'para llegar a ' + formatUSD(goal) + ' en ' + years + ' a√±os';

    document.getElementById('met1Label').textContent = 'Plazo';
    document.getElementById('met1Value').textContent = years + ' a√±os';
    document.getElementById('met1Sub').textContent = 'Edad al alcanzarlo: ' + (age + years);

    document.getElementById('met2Label').textContent = 'Total aportado';
    document.getElementById('met2Value').textContent = formatUSD(totalContrib);
    document.getElementById('met2Sub').textContent = '';

    document.getElementById('met3Label').textContent = 'Inter√©s compuesto genera';
    document.getElementById('met3Value').textContent = formatUSD(Math.max(0, totalInterest));
    document.getElementById('met3Sub').textContent = Math.max(0, (totalInterest / goal) * 100).toFixed(0) + '% del total';

    document.getElementById('met4Label').textContent = 'Rendimiento anual';
    document.getElementById('met4Value').textContent = selectedRate + '%';
    document.getElementById('met4Sub').textContent = '';

    document.getElementById('breakdownSection').classList.remove('hidden');
    const contribPct = (totalContrib / goal) * 100;
    document.getElementById('segContrib').style.width = Math.min(100, contribPct) + '%';
    document.getElementById('segInterest').style.width = Math.max(0, 100 - contribPct) + '%';

    // Chart
    const labels = [], values = [];
    for (let y = 0; y <= years; y++) {
      labels.push(age + y);
      values.push(futureValue(initial, neededMonthly, selectedRate, y * 12));
    }
    renderChart(labels, values, null);
    renderTableGoal(initial, neededMonthly, selectedRate, years, age);
    generateRecosGoal(neededMonthly, years, goal, initial, totalInterest, age);

  } else {
    // howLong: user sets monthly ‚Üí we calc years
    const monthly = parseFloat(document.getElementById('g_monthly').value) || 0;
    if (monthly <= 0) { alert('Ingres√° un aporte mensual mayor a 0.'); return; }

    const months = solveMonths(initial, monthly, selectedRate, goal);

    if (months === Infinity) {
      document.getElementById('resultTitle').textContent = 'Objetivo inalcanzable';
      const hero = document.getElementById('resultHero');
      hero.className = 'result-hero status-red';
      document.getElementById('statusBadge').textContent = '‚úï No es posible';
      document.getElementById('totalFund').textContent = '‚àû';
      document.getElementById('totalFundARS').textContent = '';
      document.getElementById('bigLabel').textContent = 'Con ese aporte y rendimiento no alcanz√°s el objetivo';
      document.getElementById('breakdownSection').classList.add('hidden');
      document.getElementById('recoContainer').innerHTML = `
        <div class="reco-box reco-red">
          <h4>üö® Necesit√°s ajustar tu plan</h4>
          <p>Con un aporte de ${formatUSD(monthly)}/mes al ${selectedRate}% anual, no lleg√°s a ${formatUSD(goal)} en un plazo razonable.</p>
          <ul>
            <li>Aument√° tu aporte mensual</li>
            <li>Consider√° un objetivo m√°s gradual</li>
            <li>Un perfil de inversi√≥n m√°s agresivo podr√≠a ayudar</li>
          </ul>
        </div>`;
      return;
    }

    const years = months / 12;
    const totalContrib = initial + monthly * months;
    const totalInterest = goal - totalContrib;

    document.getElementById('resultTitle').textContent = 'Tiempo para alcanzar ' + formatUSD(goal);

    const hero = document.getElementById('resultHero');
    hero.className = 'result-hero status-green';
    document.getElementById('statusBadge').textContent = '‚è± Tiempo estimado';

    const yrs = Math.floor(years);
    const mos = Math.round((years - yrs) * 12);
    let timeText = yrs + ' a√±o' + (yrs !== 1 ? 's' : '');
    if (mos > 0) timeText += ' y ' + mos + ' mes' + (mos !== 1 ? 'es' : '');
    document.getElementById('totalFund').textContent = timeText;
    document.getElementById('totalFundARS').textContent = '';
    document.getElementById('bigLabel').textContent = 'aportando ' + formatUSD(monthly) + '/mes al ' + selectedRate + '% anual';

    document.getElementById('met1Label').textContent = 'Edad al alcanzarlo';
    document.getElementById('met1Value').textContent = Math.round(age + years) + ' a√±os';
    document.getElementById('met1Sub').textContent = '';

    document.getElementById('met2Label').textContent = 'Total aportado';
    document.getElementById('met2Value').textContent = formatUSD(totalContrib);
    document.getElementById('met2Sub').textContent = '';

    document.getElementById('met3Label').textContent = 'Inter√©s compuesto genera';
    document.getElementById('met3Value').textContent = formatUSD(Math.max(0, totalInterest));
    document.getElementById('met3Sub').textContent = Math.max(0, (totalInterest / goal) * 100).toFixed(0) + '% del total';

    document.getElementById('met4Label').textContent = 'Objetivo';
    document.getElementById('met4Value').textContent = formatUSD(goal);
    document.getElementById('met4Sub').textContent = '‚âà ' + formatARS(goal * getARS());

    document.getElementById('breakdownSection').classList.remove('hidden');
    const contribPct = (totalContrib / goal) * 100;
    document.getElementById('segContrib').style.width = Math.min(100, contribPct) + '%';
    document.getElementById('segInterest').style.width = Math.max(0, 100 - contribPct) + '%';

    // Chart
    const totalYears = Math.ceil(years);
    const labels = [], values = [];
    for (let y = 0; y <= totalYears; y++) {
      labels.push(age + y);
      values.push(Math.min(goal, futureValue(initial, monthly, selectedRate, y * 12)));
    }
    renderChart(labels, values, null);
    renderTableGoal(initial, monthly, selectedRate, Math.ceil(years), age);
    generateRecosGoal(monthly, years, goal, initial, totalInterest, age);
  }
}

function showResults() {
  document.getElementById('placeholder').style.display = 'none';
  const results = document.getElementById('results');
  results.classList.add('visible');
  document.getElementById('resultsCard').style.alignItems = 'flex-start';
  if (window.innerWidth < 769) {
    document.getElementById('resultsCard').scrollIntoView({ behavior: 'smooth', block: 'start' });
  }
}

// ====== TABLE + CSV ======
let csvTableData = [];

function toggleTable() {
  const body = document.getElementById('tableBody');
  const arrow = document.getElementById('tableArrow');
  body.style.display = body.style.display === 'none' ? 'block' : 'none';
  arrow.style.transform = body.style.display === 'none' ? '' : 'rotate(180deg)';
}

function renderTableAge(initial, monthly, rate, years, startAge) {
  const tbody = document.getElementById('tableRows');
  tbody.innerHTML = '';
  csvTableData = [['A√±o','Edad','Aportado (USD)','Inter√©s (USD)','Total (USD)']];
  const r = rate / 100 / 12;
  let balance = initial, totalContrib = initial;
  for(let y=1; y<=years; y++) {
    for(let m=0; m<12; m++) { balance = balance*(1+r)+monthly; totalContrib+=monthly; }
    const interest = balance - totalContrib;
    csvTableData.push([y, startAge+y, Math.round(totalContrib), Math.round(interest), Math.round(balance)]);
    tbody.innerHTML += `<tr>
      <td style="padding:10px 12px;border-bottom:1px solid rgba(31,70,114,.3);">${y}</td>
      <td style="padding:10px 12px;border-bottom:1px solid rgba(31,70,114,.3);">${startAge+y}</td>
      <td style="padding:10px 12px;border-bottom:1px solid rgba(31,70,114,.3);">${formatUSD(totalContrib)}</td>
      <td style="padding:10px 12px;border-bottom:1px solid rgba(31,70,114,.3);color:var(--teal);font-weight:700;">${formatUSD(interest)}</td>
      <td style="padding:10px 12px;border-bottom:1px solid rgba(31,70,114,.3);font-weight:700;">${formatUSD(balance)}</td>
    </tr>`;
  }
}

function renderTableGoal(initial, monthly, rate, years, startAge) {
  const tbody = document.getElementById('tableRows');
  tbody.innerHTML = '';
  csvTableData = [['A√±o','Edad','Aportado (USD)','Inter√©s (USD)','Total (USD)']];
  const totalYears = Math.ceil(years);
  for(let y=1; y<=totalYears; y++) {
    const total = futureValue(initial, monthly, rate, y*12);
    const contrib = initial + monthly*y*12;
    const interest = total - contrib;
    csvTableData.push([y, startAge+y, Math.round(contrib), Math.round(Math.max(0,interest)), Math.round(total)]);
    tbody.innerHTML += `<tr>
      <td style="padding:10px 12px;border-bottom:1px solid rgba(31,70,114,.3);">${y}</td>
      <td style="padding:10px 12px;border-bottom:1px solid rgba(31,70,114,.3);">${startAge+y}</td>
      <td style="padding:10px 12px;border-bottom:1px solid rgba(31,70,114,.3);">${formatUSD(contrib)}</td>
      <td style="padding:10px 12px;border-bottom:1px solid rgba(31,70,114,.3);color:var(--teal);font-weight:700;">${formatUSD(Math.max(0,interest))}</td>
      <td style="padding:10px 12px;border-bottom:1px solid rgba(31,70,114,.3);font-weight:700;">${formatUSD(total)}</td>
    </tr>`;
  }
}

function downloadCSV() {
  if(!csvTableData.length) return;
  const csv = csvTableData.map(r => r.join(',')).join('\n');
  const blob = new Blob(['\uFEFF'+csv], {type:'text/csv;charset=utf-8;'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = 'simulacion-jubilacion.csv';
  a.click(); URL.revokeObjectURL(url);
}

// ====== CHART ======
function renderChart(labels, values, retireAge) {
  const ctx = document.getElementById('growthChart').getContext('2d');
  if (chartInstance) chartInstance.destroy();

  const gradient = ctx.createLinearGradient(0, 0, 0, 220);
  gradient.addColorStop(0, 'rgba(11, 128, 225, 0.25)');
  gradient.addColorStop(0.5, 'rgba(17, 179, 183, 0.12)');
  gradient.addColorStop(1, 'rgba(17, 179, 183, 0.0)');

  chartInstance = new Chart(ctx, {
    type: 'line',
    data: {
      labels: labels,
      datasets: [{
        data: values,
        borderColor: '#0b80e1',
        backgroundColor: gradient,
        borderWidth: 2.5,
        fill: true,
        tension: 0.35,
        pointRadius: 0,
        pointHitRadius: 10,
        segment: retireAge ? {
          borderColor: function(ctx) {
            if (labels[ctx.p0DataIndex] >= retireAge) return '#11b3b7';
            return '#0b80e1';
          }
        } : {}
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: { display: false },
        tooltip: {
          backgroundColor: '#132640',
          borderColor: '#1f4672',
          borderWidth: 1,
          titleColor: '#8da4bf',
          bodyColor: '#e4eaf2',
          titleFont: { size: 12 },
          bodyFont: { size: 13, weight: '700' },
          padding: 12,
          callbacks: {
            title: (items) => 'Edad ' + items[0].label,
            label: (item) => ' ' + formatUSD(item.raw)
          }
        }
      },
      scales: {
        x: {
          grid: { color: 'rgba(31, 70, 114, 0.4)' },
          ticks: { color: '#8da4bf', font: { size: 11 }, maxTicksLimit: 8 }
        },
        y: {
          grid: { color: 'rgba(31, 70, 114, 0.4)' },
          ticks: {
            color: '#8da4bf', font: { size: 11 },
            callback: v => {
              if (v >= 1e6) return '$' + (v/1e6).toFixed(1) + 'M';
              if (v >= 1e3) return '$' + (v/1e3).toFixed(0) + 'K';
              return '$' + v;
            },
            maxTicksLimit: 5
          }
        }
      },
      interaction: { intersect: false, mode: 'index' }
    }
  });
}

// ====== RECOMMENDATIONS ======
function generateRecosAge(status, d) {
  const container = document.getElementById('recoContainer');
  container.innerHTML = '';

  if (status === 'green') {
    container.innerHTML = `
      <div class="reco-box reco-green">
        <h4>üéâ ¬°Excelente plan!</h4>
        <p>Con tu nivel de ahorro e inversi√≥n actual, vas a poder cubrir tus gastos en el retiro con tranquilidad. Tu fondo dura ${d.fundDurationYears === Infinity ? 'indefinidamente' : d.fundDurationYears.toFixed(0) + ' a√±os'}, superando tu expectativa de vida de ${d.needYears} a√±os post-retiro.</p>
        <ul>
          <li>El inter√©s compuesto genera el <strong>${((d.totalInterest / d.totalAtRetire) * 100).toFixed(0)}%</strong> de tu capital final</li>
          <li>Consider√° diversificar entre diferentes activos para proteger tu patrimonio</li>
          <li>Revis√° este plan cada a√±o para ajustar seg√∫n inflaci√≥n y cambios de vida</li>
        </ul>
      </div>`;
  } else if (status === 'orange') {
    const extraMonthly = Math.max(50, Math.ceil((d.spend * d.needYears * 12 - d.totalAtRetire) / (d.yearsToRetire * 12) / 50) * 50);
    container.innerHTML = `
      <div class="reco-box reco-orange">
        <h4>‚ö†Ô∏è Plan ajustado ‚Äî necesita mejoras</h4>
        <p>Tu fondo dura aproximadamente ${d.fundDurationYears.toFixed(1)} a√±os, pero necesit√°s cubrir ${d.needYears} a√±os. Est√°s cerca, pero hay riesgo de quedarte corto.</p>
        <ul>
          <li>Aument√° tu aporte mensual en al menos <strong>${formatUSD(extraMonthly)}</strong> m√°s por mes</li>
          <li>Consider√° reducir tu gasto planeado de retiro a <strong>${formatUSD(d.spend * 0.8)}/mes</strong></li>
          <li>Si es posible, extend√© tu edad de jubilaci√≥n ${Math.min(5, 85 - d.retireAge)} a√±os m√°s</li>
          <li>Revis√° tu perfil de inversi√≥n: un perfil m√°s agresivo puede hacer diferencia a largo plazo</li>
        </ul>
      </div>`;
  } else {
    const needTotal = d.spend * d.needYears * 12;
    const gap = needTotal - d.totalAtRetire;
    const suggestedMonthly = Math.ceil(gap / (d.yearsToRetire * 12) / 50) * 50;
    container.innerHTML = `
      <div class="reco-box reco-red">
        <h4>üö® Plan insuficiente ‚Äî requiere acci√≥n</h4>
        <p>Con tu plan actual, tus fondos duran solo ${d.fundDurationYears.toFixed(1)} a√±os pero necesit√°s ${d.needYears} a√±os. Hay una brecha de <strong>${formatUSD(gap)}</strong> que necesit√°s cubrir.</p>
        <ul>
          <li>Tu aporte mensual deber√≠a ser al menos <strong>${formatUSD(Math.max(d.monthly + suggestedMonthly, suggestedMonthly))}</strong> para cerrar la brecha</li>
          <li>Reduc√≠ el gasto mensual planeado: con <strong>${formatUSD(d.spend * 0.6)}/mes</strong> tu plan mejora significativamente</li>
          <li>Consider√° generar fuentes de ingreso adicionales antes del retiro</li>
          <li>Jubilarte a los ${Math.min(d.retireAge + 5, 75)} en vez de ${d.retireAge} te da a√±os extra de capitalizaci√≥n</li>
        </ul>
      </div>`;
  }
}

function generateRecosGoal(monthly, years, goal, initial, interest, age) {
  const container = document.getElementById('recoContainer');
  const interestPct = Math.max(0, (interest / goal) * 100).toFixed(0);
  const yrs = Math.ceil(years);

  // Compare with 0% to show power of compound interest
  const withoutInterest = initial + monthly * yrs * 12;
  const compoundBenefit = goal - withoutInterest;

  container.innerHTML = `
    <div class="reco-box reco-green">
      <h4>üí° Claves de tu plan</h4>
      <p>Si manten√©s un aporte constante de ${formatUSD(monthly)}/mes al ${selectedRate}% anual, alcanz√°s tu objetivo de ${formatUSD(goal)} ${yrs > 1 ? 'en ' + yrs + ' a√±os' : 'en menos de un a√±o'} (a los ${Math.round(age + years)} a√±os).</p>
      <ul>
        <li>El inter√©s compuesto aporta el <strong>${interestPct}%</strong> de tu objetivo ‚Äî ${formatUSD(Math.max(0, compoundBenefit))} que no sale de tu bolsillo</li>
        <li>Empezar hoy vs. esperar 5 a√±os puede significar aportar un <strong>40-60% menos por mes</strong></li>
        <li>Automatiz√° el aporte mensual para mantener la disciplina</li>
        <li>Revis√° y ajust√° este plan cada a√±o</li>
      </ul>
    </div>`;
}

// ====== SHARE ======
function shareWhatsApp() {
  const total = document.getElementById('totalFund').textContent;
  const label = document.getElementById('bigLabel').textContent;
  const text = `üìà ${label}: ${total}\n\nSimul√° tu jubilaci√≥n gratis üëá\nnicopassini.com/calculadora-jubilacion.html`;
  window.open('https://wa.me/?text=' + encodeURIComponent(text), '_blank');
}

function shareTwitter() {
  const total = document.getElementById('totalFund').textContent;
  const text = `üìà Simul√© mi plan de jubilaci√≥n y mi capital proyectado es ${total}\n\nHac√© la tuya gratis üëá\nnicopassini.com/calculadora-jubilacion.html\n\nv√≠a @nicopassini_`;
  window.open('https://twitter.com/intent/tweet?text=' + encodeURIComponent(text), '_blank');
}

function shareFacebook() {
  window.open('https://www.facebook.com/sharer/sharer.php?u=' + encodeURIComponent('https://nicopassini.com/calculadora-jubilacion.html'), '_blank');
}

function copyLink() {
  navigator.clipboard.writeText('https://nicopassini.com/calculadora-jubilacion.html').then(() => {
    alert('‚úÖ Link copiado');
  }).catch(() => {});
}

// ====== ENTER KEY ======
document.querySelectorAll('input').forEach(input => {
  input.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') calculate();
  });
});

// Init: fetch ARS rate and update displays
fetchARSRate();
</script>

<!-- EMAIL POPUP - Nico Passini / FBC -->
<div id="emailPopup" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.65);backdrop-filter:blur(6px);z-index:9999;align-items:center;justify-content:center;">
  <div style="background:linear-gradient(160deg,#0d1b2e,#132640);border:1px solid #1f4672;border-radius:16px;padding:40px 32px;max-width:440px;width:90%;position:relative;animation:popIn .4s ease;">
    <button onclick="closePopup()" style="position:absolute;top:14px;right:14px;background:none;border:none;color:#8da4bf;font-size:22px;cursor:pointer;width:32px;height:32px;display:flex;align-items:center;justify-content:center;border-radius:8px;transition:all .2s;" onmouseover="this.style.background='rgba(232,84,84,.15)';this.style.color='#e85454'" onmouseout="this.style.background='none';this.style.color='#8da4bf'">‚úï</button>
    <div style="text-align:center;margin-bottom:24px;">
      <div style="font-size:40px;margin-bottom:12px;">üì¨</div>
      <h2 style="font-family:'Century Gothic','Questrial','Futura','Trebuchet MS',sans-serif;font-size:22px;font-weight:700;color:#fff;margin-bottom:8px;line-height:1.3;">Tips financieros gratis cada semana</h2>
      <p style="font-family:'Century Gothic','Questrial','Futura','Trebuchet MS',sans-serif;font-size:14px;color:#8da4bf;line-height:1.5;">Recib√≠ en tu mail estrategias simples para ahorrar, invertir y hacer crecer tu plata. Sin humo, sin spam.</p>
    </div>
    <div id="popupForm">
      <input type="text" id="popupName" placeholder="Tu nombre" style="width:100%;padding:14px 16px;background:#17304d;border:1.5px solid #1f4672;border-radius:10px;color:#e4eaf2;font-family:'Century Gothic','Questrial',sans-serif;font-size:15px;margin-bottom:10px;transition:border-color .25s;" onfocus="this.style.borderColor='#0b80e1'" onblur="this.style.borderColor='#1f4672'">
      <input type="email" id="popupEmail" placeholder="Tu mejor email" style="width:100%;padding:14px 16px;background:#17304d;border:1.5px solid #1f4672;border-radius:10px;color:#e4eaf2;font-family:'Century Gothic','Questrial',sans-serif;font-size:15px;margin-bottom:14px;transition:border-color .25s;" onfocus="this.style.borderColor='#0b80e1'" onblur="this.style.borderColor='#1f4672'">
      <button onclick="submitPopup()" style="width:100%;padding:16px;background:linear-gradient(135deg,#0b80e1,#11b3b7);border:none;border-radius:10px;color:#fff;font-family:'Century Gothic','Questrial',sans-serif;font-size:16px;font-weight:700;cursor:pointer;transition:all .3s;" onmouseover="this.style.transform='translateY(-2px)';this.style.boxShadow='0 8px 25px rgba(11,128,225,.3)'" onmouseout="this.style.transform='none';this.style.boxShadow='none'">Quiero recibirlos ‚Üí</button>
      <p style="text-align:center;font-size:11px;color:#8da4bf;opacity:.6;margin-top:10px;">0% spam. Te pod√©s desuscribir cuando quieras.</p>
    </div>
    <div id="popupSuccess" style="display:none;text-align:center;padding:20px 0;">
      <div style="font-size:48px;margin-bottom:12px;">üéâ</div>
      <h3 style="font-family:'Century Gothic','Questrial',sans-serif;font-size:20px;color:#11b3b7;margin-bottom:8px;">¬°Listo! Ya est√°s adentro</h3>
      <p style="font-family:'Century Gothic','Questrial',sans-serif;font-size:14px;color:#8da4bf;">Revis√° tu mail. El primer tip llega esta semana.</p>
    </div>
    <div style="text-align:center;margin-top:16px;padding-top:16px;border-top:1px solid #1f4672;">
      <span style="font-family:'Cormorant Garamond',Georgia,serif;font-size:14px;letter-spacing:3px;text-transform:uppercase;color:#8da4bf;">NICO PASSINI</span>
    </div>
  </div>
</div>
<style>
@keyframes popIn{from{opacity:0;transform:scale(.9) translateY(20px);}to{opacity:1;transform:scale(1) translateY(0);}}
#emailPopup input::placeholder{color:#5a7a9a;}
</style>
<script>
(function(){
  // CONFIG: Cambiar estos valores cuando tengas Klaviyo configurado
  const KLAVIYO_LIST_ID = 'TU_LIST_ID_ACA'; // Reemplazar con tu List ID de Klaviyo
  const KLAVIYO_PUBLIC_KEY = 'TU_PUBLIC_KEY_ACA'; // Reemplazar con tu Public API Key de Klaviyo
  const POPUP_DELAY_MS = 5000; // 5 segundos
  const POPUP_KEY = 'fbc_popup_shown';

  // No mostrar si ya se mostr√≥ en esta sesi√≥n
  if(sessionStorage.getItem(POPUP_KEY)) return;

  setTimeout(function(){
    const popup = document.getElementById('emailPopup');
    if(popup) popup.style.display = 'flex';
    sessionStorage.setItem(POPUP_KEY, '1');
  }, POPUP_DELAY_MS);
})();

function closePopup(){
  document.getElementById('emailPopup').style.display = 'none';
}

function submitPopup(){
  const name = document.getElementById('popupName').value.trim();
  const email = document.getElementById('popupEmail').value.trim();
  if(!email || !email.includes('@')){
    document.getElementById('popupEmail').style.borderColor = '#e85454';
    return;
  }

  // === KLAVIYO API INTEGRATION ===
  // Cuando tengas tus keys, descomentar este bloque:
  /*
  const KLAVIYO_LIST_ID = 'TU_LIST_ID_ACA';
  const KLAVIYO_PUBLIC_KEY = 'TU_PUBLIC_KEY_ACA';
  fetch('https://a.klaviyo.com/api/v2/list/' + KLAVIYO_LIST_ID + '/subscribe?api_key=' + KLAVIYO_PUBLIC_KEY, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      profiles: [{ email: email, first_name: name, source: 'Herramientas FBC - ' + document.title }]
    })
  }).catch(function(e){ console.log('Klaviyo error:', e); });
  */

  // Mientras tanto, log en consola para testing
  console.log('üì¨ Nuevo suscriptor:', { name, email, source: document.title });

  // Mostrar √©xito
  document.getElementById('popupForm').style.display = 'none';
  document.getElementById('popupSuccess').style.display = 'block';
  setTimeout(closePopup, 3000);
}

// Cerrar con ESC
document.addEventListener('keydown', function(e){
  if(e.key === 'Escape') closePopup();
});
// Cerrar al hacer click fuera
document.getElementById('emailPopup')?.addEventListener('click', function(e){
  if(e.target === this) closePopup();
});
</script>

<script src="lead-gate.js"></script>
</body>
</html>
